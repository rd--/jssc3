<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <script src="lib/jspreadsheet/ce/dist/index.js"></script>
    <script src="lib/jsuites/dist/jsuites.js"></script>
    <link rel="stylesheet" href="lib/jspreadsheet/ce/dist/jspreadsheet.css" type="text/css" />
    <link rel="stylesheet" href="lib/jsuites/dist/jsuites.css" type="text/css" />
    <link rel="icon" type="image/png" href="png/os.512.png" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/aaaakshat/cm-web-fonts@latest/fonts.css" />
    <link rel="stylesheet" type="text/css" media="all" href="css/sc3.css" />
    <link rel="stylesheet" type="text/css" media="all" href="css/sc3-supercalc.css" />
    <script src="lib/osc.js/dist/osc-browser.js"></script>
    <script type="module">
import * as sc from './dist/jssc3.js'
import * as calc from './js/supercalc.js'
globalThis.sc = sc;
globalThis.calc = calc;
globalThis.loadSheet = function() {
	const inputFile = sc.get_file_input_file('programInputFile', 0);
	if (inputFile) {
		sc.read_text_file_and_then(inputFile, calc.sc3_supercalc_set_json);
	} else {
		console.log('loadSheet: no file name');
	}
};
window.onload = function () {
    sc.sc3_wasm_init(sc.setStatusDisplay);
	sc.sc3_mouse_init(globalScsynth);
	sc.connect_button_to_input('programInputFileSelect', 'programInputFile');
    calc.sc3_supercalc_init(8, 8);
};
    </script>
  </head>
  <body>
    <h1>SuperCalc</h1>
    <div id="menuContainer">
      <button title="Begin (b)" accesskey="b" onclick="globalScsynth.boot()">Begin</button>
      <span id="statusText">...</span>
      <button title="Init" onclick="calc.sc3_supercalc_server_setup()">Init</button>
      <input type="file" id="programInputFile" accept=".json" onchange="loadSheet()" style="display:none">
      <button id="programInputFileSelect" title="Select and load  file to editor (l)" accesskey="l">Load</button>
      <button title="Copy json to clipboard (c)"  accesskey="c" onclick="navigator.clipboard.writeText(calc.sc3_supercalc_get_json())">Copy</button>
    </div>
    <div>
      <div id="sc3_supercalc"></div>
    </div>
    <p>
      <strong>Instructions</strong>:
      <ol>
		  <li>Press <em>Begin</em> to start the synthesiser, wait until the status says <em>#0</em>.</li>
		  <li>Press <em>Init</em> to initialise the cell programs, wait until the status says <em>#192</em>.</li>
		  <li>Read the brief <a href="http://rohandrape.net/?t=jssc3&e=md/supercalc.md" target="_blank">introductory notes</a>.</li>
	  </ol>
    </p>
    <script async src="lib/scsynth-wasm-builds/ext/scsynth.js"></script>
  </body>
</html>
