<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<script src="lib/jspreadsheet/ce/dist/index.js"></script>
		<script src="lib/jsuites/dist/jsuites.js"></script>
		<link rel="stylesheet" href="lib/jspreadsheet/ce/dist/jspreadsheet.css" type="text/css" />
		<link rel="stylesheet" href="lib/jsuites/dist/jsuites.css" type="text/css" />
		<link rel="icon" type="image/png" href="png/os.512.png" />
		<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/aaaakshat/cm-web-fonts@latest/fonts.css" />
		<link rel="stylesheet" type="text/css" media="all" href="css/superscript.css" />
		<link rel="stylesheet" type="text/css" media="all" href="css/supercalc.css" />
		<script src="lib/osc.js/dist/osc-browser.js"></script>
		<script type="module">
import * as sc from './dist/jssc3.js'
import * as sl from './lib/spl/dist/sl.js'
import * as calc from './js/supercalc.js'
globalThis.sc = sc;
globalThis.sl = sl;
globalThis.calc = calc;
globalThis.loadSheet = function() {
	const inputFile = sc.get_file_input_file('programInputFile', 0);
	if (inputFile) {
		sc.read_text_file_and_then(inputFile, calc.set_json);
	} else {
		console.log('loadSheet: no file name');
	}
};
sl.addLoadUrlMethods();
window.onload = function () {
	sc.sc3_wasm_init(sc.setter_for_inner_html_of('statusText'));
	sc.sc3_mouse_init(globalScSynth);
	sc.connect_button_to_input('programInputFileSelect', 'programInputFile');
	sl.assignGlobals();
	sl.loadUrlArrayInSequence('lib/spl/sl', ['kernel.sl', 'std.sl', 'sc.sl']);
	calc.initProgramMenu();
	calc.initSheet(8, 8);
};
		</script>
	</head>
	<body>
		<h1>SuperCalc</h1>
		<div id="menuContainer">
			<button title="Begin" accesskey="b" onclick="sc.scsynthEnsure(globalScSynth, calc.server_setup)">Begin</button>
			<span id="statusText">...</span>
			<input type="file" id="programInputFile" accept=".json" onchange="loadSheet()" style="display:none">
			<button id="programInputFileSelect" title="Select and load  file to editor (l)" accesskey="l">Load</button>
			<button title="Copy json to clipboard (c)"  accesskey="c" onclick="navigator.clipboard.writeText(calc.get_json())">Copy</button>
			<select id="programMenu" title="Program (p)" accesskey="p"><option>--Program Menu--</option></select>
			<button title="Fullscreen" accesskey="x" onclick="sc.fullscreen()">â‡±</button>
		</div>
		<div>
			<div id="supercalcContainer"></div>
		</div>
		<p>
			<strong>Instructions</strong>:
			<ol>
		  <li>
			  Press <em>Begin</em> to start the synthesiser.
			  Wait until each of the cell programs have been initialised.
			  (The status area will say <em>#192</em>).
		  <li>
			  Press <em>Load</em> to load a program from disk or select a program from the menu.
			  (To reset the system load the <em>Empty Program</em> file.)
		  </li>
		  <li>
			  Press <em>Copy</em> to copy the current state of the program to the system clipboard to save your work.
		  </li>
		  <li>
			  Read the brief <a href="http://rohandrape.net/?t=jssc3&e=md/supercalc.md" target="_blank">introductory notes</a>.
		  </li>
	  </ol>
		</p>
		<script async src="lib/scsynth-wasm-builds/ext/scsynth.js"></script>
	</body>
</html>
